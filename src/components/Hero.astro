---
const base = import.meta.env.BASE_URL;
const heroImages = [
  { src: `${base}/images/team-hero.jpg`, alt: 'Das Team von Kreuzer Trockenbau & Malerbetrieb', position: '-80% center' },
  { src: `${base}/images/hero-family.jpg`, alt: 'Das gesamte Team mit Familie', position: '-60% center' },
  { src: `${base}/images/hero-duo.jpg`, alt: 'Die Geschäftsführer vor dem Firmenfahrzeug', position: '-150% center' },
];
---

<section class="relative min-h-[85vh] sm:min-h-[90vh] flex items-center overflow-hidden">
  <!-- Left solid dark background -->
  <div class="absolute inset-0 bg-dark-950"></div>

  <!-- Slideshow Images -->
  <div class="absolute inset-0 overflow-hidden">
    {heroImages.map((image, i) => (
      <div
        class="hero-slide absolute inset-0"
        data-slide={i}
        style={`transform: translateX(${i === 0 ? '0' : '100%'}); z-index: ${i === 0 ? '2' : '1'};`}
      >
        <img
          src={image.src}
          alt={image.alt}
          class="w-full h-full object-cover"
          style={`object-position: ${image.position};`}
          loading={i === 0 ? 'eager' : 'lazy'}
        />
      </div>
    ))}

    <!-- Left: solid dark for text (staerker auf Mobile) -->
    <div class="absolute inset-0 z-10 bg-gradient-to-r from-dark-950 from-45% via-dark-950/85 via-65% to-dark-950/20 sm:from-35% sm:via-dark-950/80 sm:via-55% sm:to-transparent"></div>
    <!-- Bottom: clean fade for section transition -->
    <div class="absolute inset-0 z-10 bg-gradient-to-t from-dark-950 via-dark-950/20 via-30% to-transparent sm:via-transparent sm:via-25%"></div>
  </div>

  <!-- Slide indicators -->
  <div class="absolute bottom-6 left-4 sm:bottom-8 sm:right-8 sm:left-auto z-20 flex items-center gap-2">
    {heroImages.map((_, i) => (
      <button
        class:list={[
          'hero-dot w-8 h-1 sm:h-[2px] rounded-full transition-all duration-500 cursor-pointer py-2 bg-clip-content',
          i === 0 ? 'bg-accent-500 w-12' : 'bg-white/25',
        ]}
        data-dot={i}
        aria-label={`Bild ${i + 1}`}
      />
    ))}
  </div>

  <!-- Content (left side, narrow) -->
  <div class="relative z-10 max-w-7xl mx-auto px-5 sm:px-6 lg:px-8 pt-28 pb-16 sm:pt-40 sm:pb-28 w-full">
    <div class="max-w-lg">
      <!-- Regional Badge -->
      <div class="fade-in inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 mb-6">
        <svg class="w-4 h-4 text-white/60" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
        </svg>
        <span class="text-white/70 text-sm font-medium">Seit 2010 &middot; Bayerischer Wald</span>
      </div>

      <!-- Title -->
      <h1 class="fade-in text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-white leading-[1.1] mb-3 font-heading">
        Kreuzer<br/>
        <span class="text-accent-500">Trockenbau</span>
      </h1>
      <p class="fade-in text-lg sm:text-xl text-white/60 font-heading font-medium mb-6">
        &amp; Malermeisterbetrieb
      </p>

      <!-- Trennlinie -->
      <div class="fade-in w-12 h-0.5 bg-accent-500/60 mb-6"></div>

      <!-- Slogan -->
      <p class="fade-in text-base sm:text-lg text-dark-300 leading-relaxed mb-8 max-w-sm">
        Ihr Handwerkerteam für <strong class="text-white font-semibold">höchste Qualität</strong> und <strong class="text-white font-semibold">Präzision</strong> — von der Planung bis zur perfekten Umsetzung.
      </p>

      <!-- CTAs -->
      <div class="fade-in flex flex-col sm:flex-row items-start gap-3">
        <a
          href="/kontakt"
          class="px-7 py-3.5 bg-accent-500 hover:bg-accent-400 text-dark-950 rounded-xl text-sm font-semibold transition-all duration-300 hover:shadow-lg hover:shadow-accent-500/25 hover:-translate-y-0.5"
        >
          Jetzt Angebot anfragen
        </a>
        <a
          href="tel:+4909943905270"
          class="px-7 py-3.5 bg-white/10 hover:bg-white/15 text-white border border-white/20 rounded-xl text-sm font-semibold transition-all duration-300 hover:-translate-y-0.5 backdrop-blur-sm flex items-center gap-2"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
          </svg>
          09943 / 905270
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  const slides = document.querySelectorAll<HTMLElement>('.hero-slide');
  const dots = document.querySelectorAll<HTMLElement>('.hero-dot');
  let current = 0;
  let animating = false;
  let interval: ReturnType<typeof setInterval>;

  function goTo(index: number) {
    if (animating || index === current) return;
    animating = true;

    const outSlide = slides[current];
    const inSlide = slides[index];

    // Park all other slides off-screen (safety)
    slides.forEach((s, i) => {
      if (i !== current && i !== index) {
        s.style.transition = 'none';
        s.style.transform = 'translateX(100%)';
        s.style.zIndex = '1';
      }
    });

    // Place incoming slide to the right, no transition
    inSlide.style.transition = 'none';
    inSlide.style.transform = 'translateX(100%)';
    inSlide.style.zIndex = '3';
    outSlide.style.zIndex = '2';

    // Force reflow -- wait for browser to paint the position
    void inSlide.offsetHeight;
    void outSlide.offsetHeight;

    // Use rAF to ensure the no-transition frame is painted before animating
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        const ease = 'transform 1.4s cubic-bezier(0.22, 1, 0.36, 1)';
        outSlide.style.transition = ease;
        inSlide.style.transition = ease;
        outSlide.style.transform = 'translateX(-100%)';
        inSlide.style.transform = 'translateX(0)';
      });
    });

    // Update dots
    dots[current]?.classList.remove('bg-accent-500', 'w-12');
    dots[current]?.classList.add('bg-white/25');
    dots[index]?.classList.remove('bg-white/25');
    dots[index]?.classList.add('bg-accent-500', 'w-12');

    current = index;

    // After animation: clean up
    setTimeout(() => {
      outSlide.style.transition = 'none';
      outSlide.style.transform = 'translateX(100%)';
      outSlide.style.zIndex = '1';
      inSlide.style.zIndex = '2';
      animating = false;
    }, 1500);
  }

  function next() {
    goTo((current + 1) % slides.length);
  }

  function startAuto() {
    interval = setInterval(next, 6000);
  }

  startAuto();

  dots.forEach((dot, i) => {
    dot.addEventListener('click', () => {
      clearInterval(interval);
      goTo(i);
      startAuto();
    });
  });
</script>
