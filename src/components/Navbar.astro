---
const base = import.meta.env.BASE_URL;
const currentPath = Astro.url.pathname.replace(/\/$/, '') || '/';

const navLinks = [
  { href: `${base}/`, label: 'Start' },
  { href: `${base}/leistungen`, label: 'Leistungen' },
  { href: `${base}/team`, label: 'Team' },
  { href: `${base}/referenzen`, label: 'Referenzen' },
  { href: `${base}/ferienwohnung`, label: 'Ferienwohnung' },
  { href: `${base}/kontakt`, label: 'Kontakt' },
];

function isActive(linkHref: string) {
  const normalizedLink = linkHref.replace(/\/$/, '') || '/';
  return currentPath === normalizedLink;
}
---

<!-- Top accent line -->
<div class="fixed top-0 left-0 right-0 z-[60] h-px bg-accent-500/60"></div>

<header
  id="navbar"
  class="fixed top-px left-0 right-0 z-50 transition-all duration-500 bg-dark-950/50 backdrop-blur-md border-b border-white/0"
>
  <!-- Schwarzer Verlauf links: solide bis nach "Start", dann sanfter Übergang -->
  <div class="absolute inset-0 pointer-events-none navbar-black-fade"></div>
  <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center h-14 sm:h-16 gap-8 lg:gap-10">
      <!-- Logo -->
      <a href={`${base}/`} class="shrink-0 logo-wrap relative" id="logo-link">
        <div class="relative h-8 sm:h-9 overflow-hidden w-[90px] sm:w-[110px]">
          <img
            src={`${base}/images/kreuzer-logo-gold.png`}
            alt="Kreuzer Trockenbau"
            class="logo-img w-full h-full object-contain"
          />
        </div>
      </a>

      <!-- Desktop: Nav + Phone -->
      <div class="hidden md:flex items-center gap-6 sm:gap-8">
        <nav class="flex items-center gap-6">
          {
            navLinks.map((link) => (
              <a
                href={link.href}
                class:list={[
                  'nav-link relative text-[13px] font-heading font-medium tracking-wide transition-colors duration-300 py-1',
                  isActive(link.href) ? 'text-accent-500' : 'text-white/50 hover:text-white/90',
                ]}
              >
                {link.label}
              </a>
            ))
          }
        </nav>

        <div class="w-px h-4 bg-white/10 ml-auto"></div>

        <a
          href="tel:+4915154920918"
          class="flex items-center gap-2 text-white/50 hover:text-accent-500 transition-colors duration-300"
        >
          <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"
            ></path>
          </svg>
          <span class="text-[13px] font-heading font-medium tracking-wide">0151 / 54920918</span>
        </a>
      </div>

      <!-- Mobile Hamburger -->
      <button
        id="mobile-menu-btn"
        class="md:hidden p-3 -mr-3 ml-auto min-h-[44px] min-w-[44px] flex items-center justify-center"
        aria-label="Menü öffnen"
      >
        <div class="flex flex-col gap-1.5 w-5">
          <span class="hamburger-line h-px bg-white/70 transition-all duration-300 origin-center w-full"></span>
          <span class="hamburger-line h-px bg-white/70 transition-all duration-300 origin-center w-full"></span>
          <span class="hamburger-line h-px bg-white/70 transition-all duration-300 origin-center w-3 ml-auto"></span>
        </div>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="md:hidden hidden">
    <div class="px-4 pb-6 pt-2 bg-dark-950/98 backdrop-blur-xl border-t border-white/5">
      <div class="flex flex-col">
        {
          navLinks.map((link) => (
            <a
              href={link.href}
              class:list={[
                'px-3 py-4 text-base font-heading font-medium tracking-wide transition-colors duration-300 border-b border-white/5',
                isActive(link.href) ? 'text-accent-500' : 'text-white/40 hover:text-white',
              ]}
            >
              {link.label}
            </a>
          ))
        }
        <a
          href="tel:+4915154920918"
          class="mt-5 flex items-center gap-2 text-white/40 hover:text-accent-500 transition-colors px-3 py-3"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"
            ></path>
          </svg>
          <span class="text-sm font-heading font-medium">0151 / 54920918</span>
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  const navbar = document.getElementById('navbar');

  window.addEventListener('scroll', () => {
    if (window.scrollY > 60) {
      navbar?.classList.remove('bg-dark-950/50', 'backdrop-blur-md', 'border-white/0');
      navbar?.classList.add('bg-dark-950/90', 'backdrop-blur-xl', 'border-white/5');
    } else {
      navbar?.classList.add('bg-dark-950/50', 'backdrop-blur-md', 'border-white/0');
      navbar?.classList.remove('bg-dark-950/90', 'backdrop-blur-xl', 'border-white/5');
    }
  });

  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburgerLines = document.querySelectorAll('.hamburger-line');

  let isOpen = false;

  mobileMenuBtn?.addEventListener('click', () => {
    isOpen = !isOpen;
    mobileMenu?.classList.toggle('hidden');

    if (isOpen) {
      hamburgerLines[0]?.classList.add('rotate-45', 'translate-y-[4px]');
      hamburgerLines[1]?.classList.add('opacity-0', 'scale-x-0');
      hamburgerLines[2]?.classList.add('-rotate-45', '-translate-y-[3px]', 'w-full', 'ml-0');
    } else {
      hamburgerLines[0]?.classList.remove('rotate-45', 'translate-y-[4px]');
      hamburgerLines[1]?.classList.remove('opacity-0', 'scale-x-0');
      hamburgerLines[2]?.classList.remove('-rotate-45', '-translate-y-[3px]', 'w-full', 'ml-0');
    }
  });
</script>

<style>
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 1px;
    background: var(--color-accent-500);
    transition: width 0.3s ease;
  }
  .nav-link:hover::after {
    width: 100%;
  }

  /* Schwarzer Verlauf links in der Navbar */
  .navbar-black-fade {
    background: linear-gradient(to right, #0a0a0a 0%, #0a0a0a 22%, transparent 38%);
  }
</style>
