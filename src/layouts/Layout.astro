---
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import WhatsAppButton from '../components/WhatsAppButton.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  showWhatsApp?: boolean;
}

const {
  title,
  description = 'Kreuzer Trockenbau & Malerbetrieb – Ihr Spezialist für Trockenbau, Innenausbau und Malerarbeiten im Bayerischen Wald. Qualität aus Meisterhand seit 2010.',
  ogImage = '/images/team-hero.jpg',
  showWhatsApp = false,
} = Astro.props;

const siteURL = Astro.site!;
const canonicalURL = new URL(Astro.url.pathname, siteURL);
const ogImageURL = new URL(import.meta.env.BASE_URL + ogImage, siteURL);
---

<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="description" content={description} />
    <meta name="theme-color" content="#0a0a0a" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="format-detection" content="telephone=no" />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL.href} />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL.href} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageURL.href} />
    <meta property="og:locale" content="de_DE" />
    <meta property="og:site_name" content="Kreuzer Trockenbau & Malerbetrieb" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageURL.href} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href={`${import.meta.env.BASE_URL}/favicon.svg`} />

    <!-- Fonts (lokal gehostet, DSGVO-konform) -->
    <link
      rel="preload"
      href={`${import.meta.env.BASE_URL}/fonts/dm-sans-latin.woff2`}
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href={`${import.meta.env.BASE_URL}/fonts/space-grotesk-latin.woff2`}
      as="font"
      type="font/woff2"
      crossorigin
    />

    <!-- Structured Data: LocalBusiness -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'LocalBusiness',
        name: 'Kreuzer Trockenbau & Malerbetrieb',
        description:
          'Ihr Spezialist für Trockenbau, Innenausbau und Malerarbeiten im Bayerischen Wald. Qualität aus Meisterhand seit 2010.',
        url: siteURL.href,
        telephone: '+49-9943-905270',
        email: 'kreuzer-trockenbau@gmx.de',
        address: {
          '@type': 'PostalAddress',
          streetAddress: 'Tannenweg 2',
          addressLocality: 'Haibühl',
          postalCode: '93474',
          addressRegion: 'Bayern',
          addressCountry: 'DE',
        },
        geo: {
          '@type': 'GeoCoordinates',
          latitude: '49.19',
          longitude: '13.00',
        },
        openingHoursSpecification: [
          {
            '@type': 'OpeningHoursSpecification',
            dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
            opens: '07:00',
            closes: '17:00',
          },
        ],
        image: new URL(import.meta.env.BASE_URL + '/images/team-hero.jpg', siteURL).href,
        priceRange: '$$',
        foundingDate: '2010',
        founder: {
          '@type': 'Person',
          name: 'Markus Kreuzer',
        },
        areaServed: {
          '@type': 'GeoCircle',
          geoMidpoint: {
            '@type': 'GeoCoordinates',
            latitude: '49.19',
            longitude: '13.00',
          },
          geoRadius: '50000',
        },
        sameAs: [],
      })}
    />

    <title>{title}</title>
  </head>
  <body class="bg-dark-950 text-dark-100 font-sans antialiased">
    <Navbar />
    <main>
      <slot />
    </main>
    <Footer />
    {showWhatsApp && <WhatsAppButton />}

    <script>
      // Intersection Observer for scroll animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px',
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, observerOptions);

      document
        .querySelectorAll('.fade-in, .fade-in-left, .fade-in-right, .scale-in, .stagger-children')
        .forEach((el) => {
          observer.observe(el);
        });

      // Subtiler Parallax-Effekt
      const parallaxElements = document.querySelectorAll<HTMLElement>('[data-parallax]');
      if (parallaxElements.length > 0 && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        let ticking = false;
        window.addEventListener('scroll', () => {
          if (!ticking) {
            requestAnimationFrame(() => {
              const scrollY = window.scrollY;
              parallaxElements.forEach((el) => {
                const speed = parseFloat(el.getAttribute('data-parallax') || '0.1');
                const rect = el.getBoundingClientRect();
                const offset = (rect.top + scrollY - window.innerHeight / 2) * speed;
                el.style.transform = `translateY(${offset}px)`;
              });
              ticking = false;
            });
            ticking = true;
          }
        });
      }
    </script>
  </body>
</html>
