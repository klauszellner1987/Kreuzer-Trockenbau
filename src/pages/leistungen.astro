---
import Layout from '../layouts/Layout.astro';
import ServiceSection from '../components/ServiceSection.astro';
import { services } from '../data/services';

const base = import.meta.env.BASE_URL;
---

<Layout
  title="Leistungen – Kreuzer Trockenbau & Malerbetrieb"
  description="Unsere Leistungen: Trockenbau, Innenausbau, Malerarbeiten, Bodenbeläge, Fassadengestaltung, Fliesenarbeiten und mehr."
>
  <!-- Page Header with Video Background -->
  <section class="relative min-h-[50vh] sm:min-h-[60vh] flex items-end overflow-hidden">
    <div class="absolute inset-0">
      <video
        class="w-full h-full object-cover"
        src={`${base}/videos/leistungen-header-v3.mp4`}
        autoplay
        muted
        loop
        playsinline
        preload="auto"
        poster={`${base}/images/service-fassade.jpg`}></video>
      <div class="absolute inset-0 bg-dark-950/60"></div>
      <div class="absolute inset-0 bg-gradient-to-t from-dark-950 via-dark-950/40 via-30% to-transparent"></div>
    </div>
    <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12 sm:pb-16 pt-36 w-full text-center">
      <span class="text-accent-500 text-sm font-medium uppercase tracking-widest fade-in">Was wir bieten</span>
      <h1 class="text-4xl sm:text-5xl lg:text-6xl font-light text-white mt-4 mb-5 fade-in font-heading tracking-tight">
        Unsere Leistungen
      </h1>
      <div class="h-0.5 w-16 bg-accent-500 rounded-full mx-auto mb-6 fade-in"></div>
      <p class="text-white/70 text-lg max-w-2xl mx-auto fade-in leading-relaxed">
        Wir sind ein Handwerker-Team und legen sehr großen Wert auf Qualität, Sauberkeit und Zuverlässigkeit — und das
        alles zu erschwinglichen Preisen.
      </p>
    </div>
  </section>

  <!-- Sticky Service Navigation -->
  <nav
    id="service-nav"
    class="sticky top-[57px] sm:top-[65px] z-30 bg-dark-950/90 backdrop-blur-md border-b border-white/[0.04] transition-all duration-300"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center gap-1 overflow-x-auto no-scrollbar py-3" id="service-nav-scroll">
        {
          services.map((service, i) => {
            const id = service.title
              .toLowerCase()
              .replace(/[^a-z0-9]+/g, '-')
              .replace(/-+$/, '');
            return (
              <a
                href={`#${id}`}
                class="service-nav-link shrink-0 px-4 py-2 rounded-lg text-xs sm:text-sm font-medium text-dark-400 hover:text-white hover:bg-white/5 transition-all duration-300 whitespace-nowrap"
                data-nav-target={id}
              >
                {service.title.split(' ')[0]}
              </a>
            );
          })
        }
      </div>
    </div>
  </nav>

  <!-- Service Sections -->
  <div class="bg-dark-950">
    {services.map((service, i) => <ServiceSection service={service} index={i} total={services.length} />)}
  </div>

  <!-- Bottom CTA -->
  <section class="py-20 sm:py-32 lg:py-40 bg-dark-900">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center fade-in">
      <h2 class="text-3xl sm:text-4xl font-light text-white mb-8 font-heading tracking-tight">
        Wir können noch viel mehr!
      </h2>
      <p class="text-dark-300 text-lg leading-relaxed mb-10">
        Unsere Stärken sind in erster Linie der Trockenbau und das Malerhandwerk. Aber wir sind sehr flexibel! Fragen
        Sie uns einfach — wir finden eine Lösung für Ihr Projekt.
      </p>
      <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-center gap-4">
        <a
          href="tel:+4909943905270"
          class="px-8 py-4 bg-accent-500 hover:bg-accent-400 text-dark-950 rounded-xl text-base font-semibold transition-all duration-300 hover:shadow-lg hover:shadow-accent-500/25 hover:-translate-y-0.5 flex items-center justify-center gap-2"
        >
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"
            ></path>
          </svg>
          Jetzt anrufen
        </a>
        <a
          href={`${base}/kontakt`}
          class="px-8 py-4 bg-white/5 hover:bg-white/10 text-white border border-white/10 rounded-xl text-base font-semibold transition-all duration-300 hover:-translate-y-0.5 flex items-center justify-center"
        >
          Kontakt aufnehmen
        </a>
      </div>
    </div>
  </section>
</Layout>

<style is:global>
  /* Hide scrollbar for service nav */
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  /* Active nav link */
  .service-nav-link.active {
    color: rgb(var(--color-accent-500));
    background: rgba(var(--color-accent-500), 0.1);
  }
</style>

<script>
  // === Highlight active nav link on scroll ===
  const navLinks = document.querySelectorAll<HTMLAnchorElement>('.service-nav-link');
  const sections = document.querySelectorAll<HTMLElement>('.service-section');
  const navScroll = document.getElementById('service-nav-scroll');

  function updateActiveNav() {
    const scrollY = window.scrollY + window.innerHeight * 0.4;
    let activeId = '';

    sections.forEach((section) => {
      const top = section.offsetTop;
      const height = section.offsetHeight;
      if (scrollY >= top && scrollY < top + height) {
        activeId = section.id;
      }
    });

    navLinks.forEach((link) => {
      const target = link.dataset.navTarget;
      if (target === activeId) {
        link.classList.add('active');
        // Scroll nav to keep active link visible
        if (navScroll) {
          const linkRect = link.getBoundingClientRect();
          const navRect = navScroll.getBoundingClientRect();
          if (linkRect.left < navRect.left || linkRect.right > navRect.right) {
            link.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
          }
        }
      } else {
        link.classList.remove('active');
      }
    });
  }

  window.addEventListener('scroll', updateActiveNav, { passive: true });
  updateActiveNav();

  // === Smooth scroll for nav links ===
  navLinks.forEach((link) => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const targetId = link.dataset.navTarget;
      const target = document.getElementById(targetId || '');
      if (target) {
        const navHeight = document.getElementById('service-nav')?.offsetHeight || 0;
        const navbarHeight = 65;
        const targetTop = target.offsetTop - navHeight - navbarHeight;
        window.scrollTo({ top: targetTop, behavior: 'smooth' });
      }
    });
  });
</script>
